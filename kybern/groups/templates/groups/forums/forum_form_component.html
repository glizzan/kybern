<script type="text/x-template" id="forum_form_component_template">

    <b-modal id="forum_modal" :title="title_string" size="md" :visible=true hide-footer @hide="$router.go(-1)">
            
        <b-form-group id="name_form_group" label="Forum name:" label-for="forum_name">
            <b-form-input id="forum_name" name="forum_name" v-model="name" required placeholder="Please pick a name">
            </b-form-input>
        </b-form-group>

        <b-form-group id="description_form_group" label="Forum description:" label-for="forum_description">
            <b-form-textarea id="forum_description" name="forum_description" v-model="description" placeholder="Add a description">
            </b-form-textarea>
        </b-form-group>

        <b-button v-if=!forum_id variant="outline-secondary" class="btn-sm" id="add_forum_button" 
            @click="add_forum">submit</b-button>
        <b-button v-if=forum_id variant="outline-secondary" class="btn-sm" id="edit_forum_save_button" 
            @click="edit_forum">submit</b-button>

        <error-component :message=error_message></error-component>

    </b-modal>

</script>

<script type="application/javascript"> 

    var forumFormComponent = Vue.component('forum-form-component', {
        delimiters: ['[[', ']]'],
        template: '#forum_form_component_template',
        props: ['forum_id'],
        store,
        data: function() {
            return {
                name: null,
                description: null,
                error_message: null
            }
        },
        created () {
            if (this.forum_id) {
                forum = this.getForumData(this.forum_id)
                this.name = forum.name
                this.description = forum.description
            }
        },
        computed: {
            ...Vuex.mapState({ forums: state => state.forums.forums }),
            ...Vuex.mapGetters(['getForumData']),
            title_string: function() {
                if (this.forum_id) {  return "Edit forum '" + this.name + "'" }
                else { return "Add a new forum" }
            }
        },
        methods: {
            ...Vuex.mapActions(['addForum', 'editForum']),
            add_forum() { 
                this.addForum({ name: this.name, description: this.description })
                .catch(error => {  console.log(error), this.error_message = error })
                // close modal on success (in then)
            }, 
            edit_forum() {
                this.editForum({ pk: parseInt(this.forum_id), name: this.name, description: this.description })
                .catch(error => {  this.error_message = error })
            }
        }
    })

</script>