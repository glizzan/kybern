<script type="text/x-template" id="action_detail_component_template">

    <span v-if="ready_to_render">

        <h5>Details for action [[ action.action_pk ]]: [[ action.description ]]</h5>

        <b-card border-variant="secondary" class="my-3">
                Action [[ action.action_pk ]] ([[ action.description ]]) was taken by [[ action.actor ]]
                on [[ action.display_date ]].
        </b-card>

        <b-card v-if=action.is_template bg-variant="light" header="This is a template action" class="my-3">
                <b-card-text>
                    <p>When a template action is implemented, it applies a series of other actions.
                    Here are the actions implemented by
                    <span v-if="action.template_description.name">the [[action.template_description.name]]</span>
                    <span v-else>this</span>
                    template:</p>

                        <ul class="my-2">
                            <li v-for="action in action.template_description.actions">[[ action ]]</li>
                        </ul>

                    <p>The user has added the following information:</p>
                        <ul class="my-2">
                            <li v-for="field in action.template_description.supplied_fields.fields">[[ field ]]</li>
                            <li v-if="action.template_description.supplied_fields.fields.length == 0">
                                    There are no user-supplied fields for this template.</li>
                        </ul>
                    <p>[[action.template_description.foundational]]</p>
                </b-card-text>
        </b-card>

        <b-card border-variant="secondary" class="my-3" v-if="condition_type">

                This action has a condition on it.  To pass the condition, [[ condition_pass ]].

                <approve-condition-ui v-if="condition_type=='ApprovalCondition'" :condition_pk=condition_pk
                    :condition_type=condition_type :action_details=action></approve-condition-ui>

                <vote-condition-ui v-if="condition_type=='VoteCondition'" :condition_pk=condition_pk
                    :condition_type=condition_type :action_details=action></vote-condition-ui>

                <consensus-condition-ui v-if="condition_type=='ConsensusCondition'" :condition_pk=condition_pk
                    :condition_type=condition_type :action_details=action></consensus-condition-ui>

        </b-card>

        <b-card border-variant="secondary" class="my-3">
                <comment-list :item_id=action_id :item_model="'action'" class="my-3"> </comment-list>
        </b-card>



    </span>

</script>



<script type="application/javascript">

    actionDetailComponent = Vue.component('action-detail-component', {
        delimiters: ['[[', ']]'],
        template: '#action_detail_component_template',
        props: ['action_id'],
        store,
        data: function() {
            return {
                ready_to_render: false,
                action: null,
                condition_type: null,
                condition_pk: null,
                condition_pass: null
            }
        },
        created () {
            this.action = this.getActionData(this.action_id)
            if (typeof this.action === "undefined") {
                this.addOrUpdateAction({ action_pk: this.action_id })
                .catch(error => { console.log(error) })
            } else {
                this.ready_to_render = true
            }
        },
        watch: {
            actions: function(val) {
                this.action = this.getActionData(this.action_id)
                if (typeof this.action !== "undefined") {
                    this.ready_to_render = true
                }
            },
            action: function(val) {
                if (val && val.has_condition.conditions[0]) {
                    this.condition_type = val.has_condition.conditions[0].type
                    this.condition_pk = val.has_condition.conditions[0].pk
                    this.condition_pass = val.has_condition.conditions[0].passing_description
                }
            }
        },
        computed: {
            ...Vuex.mapGetters(['getActionData']),
            ...Vuex.mapState({ actions: state => state.concord_actions.actions }),
        },
        methods: {
            ...Vuex.mapActions(['addOrUpdateAction']),
        }

    })

</script>
